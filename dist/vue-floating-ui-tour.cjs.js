"use strict";var E=Object.defineProperty;var w=(p,e,s)=>e in p?E(p,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[e]=s;var v=(p,e,s)=>w(p,typeof e!="symbol"?e+"":e,s);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const g=require("@floating-ui/dom"),m=require("vue"),C=()=>`tour_step_${Math.random().toString(36).substring(2,9)}`;class x{constructor(e=[],s={}){v(this,"steps",[]);v(this,"currentStepIndex",-1);v(this,"isActive",!1);v(this,"options");v(this,"popoverElement");v(this,"arrowElement");v(this,"cleanupFloatingUI");v(this,"highlightOverlay");v(this,"originalTargetStyles",new Map);this.options={defaultPlacement:"bottom",defaultOffset:10,popoverClass:"v-tour__popover",arrowClass:"v-tour__arrow",padding:8,highlightTarget:!0,highlightClass:"v-tour__highlighted-target",overlayClass:"v-tour__overlay",overlayColor:"rgba(0,0,0,0.3)",onTourStart:()=>{},onTourEnd:()=>{},onStepChange:()=>{},renderPopover:this._defaultRenderPopover.bind(this),...s},this.defineSteps(e)}_getTargetElement(e){if(typeof e=="string")try{return document.querySelector(e)}catch(s){return console.error(`[TourController] Invalid selector: ${e}`,s),null}return e}_createOrGetPopover(e){const s={next:()=>this.next(),prev:()=>this.prev(),finish:()=>this.end()},i=this.options.renderPopover(e,s,this);return!i||!(i instanceof HTMLElement)?(console.error("[TourController] renderPopover must return an HTMLElement."),null):(this.popoverElement=i,this.popoverElement.isConnected||document.body.appendChild(this.popoverElement),this.options.arrowClass&&this.popoverElement.classList.contains(this.options.popoverClass)&&(this.arrowElement=this.popoverElement.querySelector(`.${this.options.arrowClass}`)||void 0),this.popoverElement)}_defaultRenderPopover(e,s){let i=document.getElementById("v-tour-default-popover");if(i||(i=document.createElement("div"),i.id="v-tour-default-popover",i.className=this.options.popoverClass,i.style.position="absolute",i.style.zIndex="10002",i.style.display="none"),i.innerHTML="",this.options.arrowClass){const t=document.createElement("div");t.className=this.options.arrowClass,t.style.position="absolute",i.appendChild(t),this.arrowElement=t}else this.arrowElement=void 0;if(e.title){const t=document.createElement("h3");t.className="v-tour__title",t.textContent=e.title,i.appendChild(t)}const n=document.createElement("div");n.className="v-tour__content";const h=typeof e.content=="function"?e.content(e,this.currentStepIndex,this):e.content;typeof h=="string"?n.innerHTML=h:h instanceof HTMLElement&&n.appendChild(h),i.appendChild(n);const d=document.createElement("div");if(d.className="v-tour__footer",this.currentStepIndex>0){const t=document.createElement("button");t.type="button",t.textContent="Previous",t.className="v-tour__button v-tour__button-prev",t.onclick=s.prev,d.appendChild(t)}if(this.currentStepIndex<this.steps.length-1){const t=document.createElement("button");t.type="button",t.textContent="Next",t.className="v-tour__button v-tour__button-next",t.onclick=s.next,d.appendChild(t)}const u=document.createElement("button");return u.type="button",u.textContent=this.currentStepIndex===this.steps.length-1?"Finish":"Close",u.className="v-tour__button v-tour__button-finish",u.onclick=s.finish,d.appendChild(u),d.hasChildNodes()&&i.appendChild(d),i}defineSteps(e){this.steps=e.map(s=>({...s,id:s.id||C()})),this.isActive&&this.currentStepIndex>=this.steps.length?this.end():this.isActive&&this.currentStepIndex!==-1&&this._showStepOnTarget(this.currentStepIndex)}start(e=0){if(!this.steps.length){console.warn("[TourController] No steps defined.");return}this.isActive=!0,this.options.onTourStart(this);const s=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;this.currentStepIndex=-1,this._showStepOnTarget(e,s)}async _showStepOnTarget(e,s=null){if(e<0||e>=this.steps.length){this.end();return}const i=this.currentStepIndex;i!==-1&&i!==e&&await this._hideStepUI(this.steps[i]),this.currentStepIndex=e;const n=this.steps[e],h=this._getTargetElement(n.target);if(!h){console.warn(`[TourController] Target element not found for step ${e}:`,n.target),this.currentStepIndex<this.steps.length-1?this.next():this.end();return}if(n.onBeforeShow&&n.onBeforeShow(n,e,this)===!1){this.currentStepIndex<this.steps.length-1?this.next():this.end();return}const d=this._createOrGetPopover(n);if(this.popoverElement=d||void 0,!this.popoverElement){this.end();return}this.popoverElement.style.display="block",h.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),this._applyHighlight(h);const u=[g.offset(n.offsetValue??this.options.defaultOffset),g.inline(),g.flip({padding:this.options.padding}),g.shift({padding:this.options.padding}),g.hide({strategy:"referenceHidden"}),...n.middleware||[]];this.arrowElement&&u.push(g.arrow({element:this.arrowElement,padding:this.options.padding}));const t=async()=>{var f;if(!this.isActive||!h.isConnected||!this.popoverElement||!this.popoverElement.isConnected){this.cleanupFloatingUI&&this.cleanupFloatingUI();return}const c=await g.computePosition(h,this.popoverElement,{placement:n.placement||this.options.defaultPlacement,middleware:u});if(this.popoverElement.style.left=`${c.x}px`,this.popoverElement.style.top=`${c.y}px`,(f=c.middlewareData.hide)!=null&&f.referenceHidden?this.popoverElement.style.visibility="hidden":this.popoverElement.style.visibility="visible",this.arrowElement&&c.middlewareData.arrow){const{x:S,y}=c.middlewareData.arrow,I={top:"bottom",right:"left",bottom:"top",left:"right"}[c.placement.split("-")[0]];Object.assign(this.arrowElement.style,{left:S!=null?`${S}px`:"",top:y!=null?`${y}px`:"",right:"",bottom:"",[I]:`-${this.arrowElement.offsetHeight/2}px`})}};this.cleanupFloatingUI&&this.cleanupFloatingUI(),this.cleanupFloatingUI=g.autoUpdate(h,this.popoverElement,t,{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,animationFrame:!0});const o=this.steps[this.currentStepIndex],a=s!==void 0?s:i!==-1&&i!==e?this.steps[i]:null;(this.currentStepIndex!==i||a&&a.id!==o.id)&&this.options.onStepChange(o,a,this),n.onAfterShow&&n.onAfterShow(n,e,this)}_applyHighlight(e){this.options.highlightTarget&&(this.highlightOverlay||(this.highlightOverlay=document.createElement("div"),this.highlightOverlay.className=this.options.overlayClass,this.highlightOverlay.style.position="fixed",this.highlightOverlay.style.top="0",this.highlightOverlay.style.left="0",this.highlightOverlay.style.width="100vw",this.highlightOverlay.style.height="100vh",this.highlightOverlay.style.zIndex="10000",this.highlightOverlay.style.pointerEvents="none",this.highlightOverlay.style.backgroundColor=this.options.overlayColor,document.body.appendChild(this.highlightOverlay)),this.highlightOverlay.style.display="block",this.originalTargetStyles.has(e)||this.originalTargetStyles.set(e,{position:e.style.position,zIndex:e.style.zIndex,boxShadow:e.style.boxShadow}),e.style.position=e.style.position==="static"||!e.style.position?"relative":e.style.position,e.style.zIndex="10001",e.style.boxShadow=`0 0 0 9999px ${this.options.overlayColor}`,this.options.highlightClass&&e.classList.add(this.options.highlightClass))}_removeHighlight(e){if(this.highlightOverlay&&(this.highlightOverlay.style.display="none"),e){const s=this.originalTargetStyles.get(e);s?(e.style.position=s.position||"",e.style.zIndex=s.zIndex||"",e.style.boxShadow=s.boxShadow||"",this.originalTargetStyles.delete(e)):(e.style.removeProperty("z-index"),e.style.removeProperty("box-shadow")),this.options.highlightClass&&e.classList.remove(this.options.highlightClass)}}async _hideStepUI(e,s=!1){if(e.onBeforeHide&&e.onBeforeHide(e,this.currentStepIndex,this)===!1&&!s)return;this.cleanupFloatingUI&&(this.cleanupFloatingUI(),this.cleanupFloatingUI=void 0),this.popoverElement&&(this.popoverElement.style.display="none");const i=this._getTargetElement(e.target);this._removeHighlight(i),e.onAfterHide&&e.onAfterHide(e,this.currentStepIndex,this)}next(){if(this.isActive)if(this.currentStepIndex<this.steps.length-1){const e=this.steps[this.currentStepIndex];this._showStepOnTarget(this.currentStepIndex+1,e)}else this.end()}prev(){if(this.isActive&&this.currentStepIndex>0){const e=this.steps[this.currentStepIndex];this._showStepOnTarget(this.currentStepIndex-1,e)}}jumpTo(e){if(!this.isActive)return;const s=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;let i=-1;typeof e=="number"?i=e:i=this.steps.findIndex(n=>n.id===e),i!==-1&&i!==this.currentStepIndex?this._showStepOnTarget(i,s):i===-1&&console.warn(`[TourController] Step with ID or index "${e}" not found.`)}end(){if(!this.isActive)return;const e=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;e&&this._hideStepUI(e,!0);const s=e;this.isActive=!1,this.currentStepIndex=-1,this.options.renderPopover===this._defaultRenderPopover.bind(this)&&this.popoverElement?(this.popoverElement.remove(),this.popoverElement=void 0,this.arrowElement=void 0):this.popoverElement&&(this.popoverElement.style.display="none"),this.highlightOverlay&&(this.highlightOverlay.remove(),this.highlightOverlay=void 0),this.originalTargetStyles.clear(),this.options.onTourEnd(this),this.options.onStepChange(null,s,this)}updateOptions(e){this.options={...this.options,...e},this.isActive&&this.currentStepIndex!==-1&&this._showStepOnTarget(this.currentStepIndex)}}let r=m.ref(null);const l=m.reactive({isActive:!1,currentStepIndex:-1,currentStep:null,totalSteps:0});function _(p=[],e={}){if(r.value)r.value.updateOptions(e),(p.length>0||p.length===0&&r.value.steps.length>0)&&(r.value.defineSteps(p),l.totalSteps=r.value.steps.length);else{const t={...e,onTourStart:o=>{var a;l.isActive=!0,l.totalSteps=o.steps.length,(a=e.onTourStart)==null||a.call(e,o)},onTourEnd:o=>{var a;l.isActive=!1,l.currentStepIndex=-1,l.currentStep=null,(a=e.onTourEnd)==null||a.call(e,o)},onStepChange:(o,a,c)=>{var f;l.currentStepIndex=c.currentStepIndex,l.currentStep=o,l.totalSteps=c.steps.length,(f=e.onStepChange)==null||f.call(e,o,a,c)}};r.value=new x(p,t),l.isActive=r.value.isActive,l.currentStepIndex=r.value.currentStepIndex,l.currentStep=r.value.currentStepIndex!==-1?r.value.steps[r.value.currentStepIndex]:null,l.totalSteps=r.value.steps.length}const s=t=>{var o;(o=r.value)==null||o.defineSteps(t)},i=t=>{var o;return(o=r.value)==null?void 0:o.start(t)},n=()=>{var t;return(t=r.value)==null?void 0:t.next()},h=()=>{var t;return(t=r.value)==null?void 0:t.prev()},d=()=>{var t;return(t=r.value)==null?void 0:t.end()},u=t=>{var o;return(o=r.value)==null?void 0:o.jumpTo(t)};return{state:m.readonly(l),defineSteps:s,start:i,next:n,prev:h,jumpTo:u,end:d}}exports.TourController=x;exports.useTour=_;
//# sourceMappingURL=vue-floating-ui-tour.cjs.js.map
