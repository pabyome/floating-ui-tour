(function(h,o){typeof exports=="object"&&typeof module<"u"?o(exports,require("@floating-ui/dom"),require("vue")):typeof define=="function"&&define.amd?define(["exports","@floating-ui/dom","vue"],o):(h=typeof globalThis<"u"?globalThis:h||self,o(h.VueFloatingUITour={},h.FloatingUIDOM,h.Vue))})(this,function(h,o,g){"use strict";var _=Object.defineProperty;var T=(h,o,g)=>o in h?_(h,o,{enumerable:!0,configurable:!0,writable:!0,value:g}):h[o]=g;var f=(h,o,g)=>T(h,typeof o!="symbol"?o+"":o,g);const E=()=>`tour_step_${Math.random().toString(36).substring(2,9)}`;class S{constructor(e=[],n={}){f(this,"steps",[]);f(this,"currentStepIndex",-1);f(this,"isActive",!1);f(this,"options");f(this,"popoverElement");f(this,"arrowElement");f(this,"cleanupFloatingUI");f(this,"highlightOverlay");f(this,"originalTargetStyles",new Map);this.options={defaultPlacement:"bottom",defaultOffset:10,popoverClass:"v-tour__popover",arrowClass:"v-tour__arrow",padding:8,highlightTarget:!0,highlightClass:"v-tour__highlighted-target",overlayClass:"v-tour__overlay",overlayColor:"rgba(0,0,0,0.3)",onTourStart:()=>{},onTourEnd:()=>{},onStepChange:()=>{},renderPopover:this._defaultRenderPopover.bind(this),...n},this.defineSteps(e)}_getTargetElement(e){if(typeof e=="string")try{return document.querySelector(e)}catch(n){return console.error(`[TourController] Invalid selector: ${e}`,n),null}return e}_createOrGetPopover(e){const n={next:()=>this.next(),prev:()=>this.prev(),finish:()=>this.end()},i=this.options.renderPopover(e,n,this);return!i||!(i instanceof HTMLElement)?(console.error("[TourController] renderPopover must return an HTMLElement."),null):(this.popoverElement=i,this.popoverElement.isConnected||document.body.appendChild(this.popoverElement),this.options.arrowClass&&this.popoverElement.classList.contains(this.options.popoverClass)&&(this.arrowElement=this.popoverElement.querySelector(`.${this.options.arrowClass}`)||void 0),this.popoverElement)}_defaultRenderPopover(e,n){let i=document.getElementById("v-tour-default-popover");if(i||(i=document.createElement("div"),i.id="v-tour-default-popover",i.className=this.options.popoverClass,i.style.position="absolute",i.style.zIndex="10002",i.style.display="none"),i.innerHTML="",this.options.arrowClass){const t=document.createElement("div");t.className=this.options.arrowClass,t.style.position="absolute",i.appendChild(t),this.arrowElement=t}else this.arrowElement=void 0;if(e.title){const t=document.createElement("h3");t.className="v-tour__title",t.textContent=e.title,i.appendChild(t)}const s=document.createElement("div");s.className="v-tour__content";const a=typeof e.content=="function"?e.content(e,this.currentStepIndex,this):e.content;typeof a=="string"?s.innerHTML=a:a instanceof HTMLElement&&s.appendChild(a),i.appendChild(s);const d=document.createElement("div");if(d.className="v-tour__footer",this.currentStepIndex>0){const t=document.createElement("button");t.type="button",t.textContent="Previous",t.className="v-tour__button v-tour__button-prev",t.onclick=n.prev,d.appendChild(t)}if(this.currentStepIndex<this.steps.length-1){const t=document.createElement("button");t.type="button",t.textContent="Next",t.className="v-tour__button v-tour__button-next",t.onclick=n.next,d.appendChild(t)}const c=document.createElement("button");return c.type="button",c.textContent=this.currentStepIndex===this.steps.length-1?"Finish":"Close",c.className="v-tour__button v-tour__button-finish",c.onclick=n.finish,d.appendChild(c),d.hasChildNodes()&&i.appendChild(d),i}defineSteps(e){this.steps=e.map(n=>({...n,id:n.id||E()})),this.isActive&&this.currentStepIndex>=this.steps.length?this.end():this.isActive&&this.currentStepIndex!==-1&&this._showStepOnTarget(this.currentStepIndex)}start(e=0){if(!this.steps.length){console.warn("[TourController] No steps defined.");return}this.isActive=!0,this.options.onTourStart(this);const n=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;this.currentStepIndex=-1,this._showStepOnTarget(e,n)}async _showStepOnTarget(e,n=null){if(e<0||e>=this.steps.length){this.end();return}const i=this.currentStepIndex;i!==-1&&i!==e&&await this._hideStepUI(this.steps[i]),this.currentStepIndex=e;const s=this.steps[e],a=this._getTargetElement(s.target);if(!a){console.warn(`[TourController] Target element not found for step ${e}:`,s.target),this.currentStepIndex<this.steps.length-1?this.next():this.end();return}if(s.onBeforeShow&&s.onBeforeShow(s,e,this)===!1){this.currentStepIndex<this.steps.length-1?this.next():this.end();return}const d=this._createOrGetPopover(s);if(this.popoverElement=d||void 0,!this.popoverElement){this.end();return}this.popoverElement.style.display="block",a.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),this._applyHighlight(a);const c=[o.offset(s.offsetValue??this.options.defaultOffset),o.inline(),o.flip({padding:this.options.padding}),o.shift({padding:this.options.padding}),o.hide({strategy:"referenceHidden"}),...s.middleware||[]];this.arrowElement&&c.push(o.arrow({element:this.arrowElement,padding:this.options.padding}));const t=async()=>{var y;if(!this.isActive||!a.isConnected||!this.popoverElement||!this.popoverElement.isConnected){this.cleanupFloatingUI&&this.cleanupFloatingUI();return}const v=await o.computePosition(a,this.popoverElement,{placement:s.placement||this.options.defaultPlacement,middleware:c});if(this.popoverElement.style.left=`${v.x}px`,this.popoverElement.style.top=`${v.y}px`,(y=v.middlewareData.hide)!=null&&y.referenceHidden?this.popoverElement.style.visibility="hidden":this.popoverElement.style.visibility="visible",this.arrowElement&&v.middlewareData.arrow){const{x,y:I}=v.middlewareData.arrow,C={top:"bottom",right:"left",bottom:"top",left:"right"}[v.placement.split("-")[0]];Object.assign(this.arrowElement.style,{left:x!=null?`${x}px`:"",top:I!=null?`${I}px`:"",right:"",bottom:"",[C]:`-${this.arrowElement.offsetHeight/2}px`})}};this.cleanupFloatingUI&&this.cleanupFloatingUI(),this.cleanupFloatingUI=o.autoUpdate(a,this.popoverElement,t,{ancestorScroll:!0,ancestorResize:!0,elementResize:!0,animationFrame:!0});const r=this.steps[this.currentStepIndex],u=n!==void 0?n:i!==-1&&i!==e?this.steps[i]:null;(this.currentStepIndex!==i||u&&u.id!==r.id)&&this.options.onStepChange(r,u,this),s.onAfterShow&&s.onAfterShow(s,e,this)}_applyHighlight(e){this.options.highlightTarget&&(this.highlightOverlay||(this.highlightOverlay=document.createElement("div"),this.highlightOverlay.className=this.options.overlayClass,this.highlightOverlay.style.position="fixed",this.highlightOverlay.style.top="0",this.highlightOverlay.style.left="0",this.highlightOverlay.style.width="100vw",this.highlightOverlay.style.height="100vh",this.highlightOverlay.style.zIndex="10000",this.highlightOverlay.style.pointerEvents="none",this.highlightOverlay.style.backgroundColor=this.options.overlayColor,document.body.appendChild(this.highlightOverlay)),this.highlightOverlay.style.display="block",this.originalTargetStyles.has(e)||this.originalTargetStyles.set(e,{position:e.style.position,zIndex:e.style.zIndex,boxShadow:e.style.boxShadow}),e.style.position=e.style.position==="static"||!e.style.position?"relative":e.style.position,e.style.zIndex="10001",e.style.boxShadow=`0 0 0 9999px ${this.options.overlayColor}`,this.options.highlightClass&&e.classList.add(this.options.highlightClass))}_removeHighlight(e){if(this.highlightOverlay&&(this.highlightOverlay.style.display="none"),e){const n=this.originalTargetStyles.get(e);n?(e.style.position=n.position||"",e.style.zIndex=n.zIndex||"",e.style.boxShadow=n.boxShadow||"",this.originalTargetStyles.delete(e)):(e.style.removeProperty("z-index"),e.style.removeProperty("box-shadow")),this.options.highlightClass&&e.classList.remove(this.options.highlightClass)}}async _hideStepUI(e,n=!1){if(e.onBeforeHide&&e.onBeforeHide(e,this.currentStepIndex,this)===!1&&!n)return;this.cleanupFloatingUI&&(this.cleanupFloatingUI(),this.cleanupFloatingUI=void 0),this.popoverElement&&(this.popoverElement.style.display="none");const i=this._getTargetElement(e.target);this._removeHighlight(i),e.onAfterHide&&e.onAfterHide(e,this.currentStepIndex,this)}next(){if(this.isActive)if(this.currentStepIndex<this.steps.length-1){const e=this.steps[this.currentStepIndex];this._showStepOnTarget(this.currentStepIndex+1,e)}else this.end()}prev(){if(this.isActive&&this.currentStepIndex>0){const e=this.steps[this.currentStepIndex];this._showStepOnTarget(this.currentStepIndex-1,e)}}jumpTo(e){if(!this.isActive)return;const n=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;let i=-1;typeof e=="number"?i=e:i=this.steps.findIndex(s=>s.id===e),i!==-1&&i!==this.currentStepIndex?this._showStepOnTarget(i,n):i===-1&&console.warn(`[TourController] Step with ID or index "${e}" not found.`)}end(){if(!this.isActive)return;const e=this.currentStepIndex!==-1?this.steps[this.currentStepIndex]:null;e&&this._hideStepUI(e,!0);const n=e;this.isActive=!1,this.currentStepIndex=-1,this.options.renderPopover===this._defaultRenderPopover.bind(this)&&this.popoverElement?(this.popoverElement.remove(),this.popoverElement=void 0,this.arrowElement=void 0):this.popoverElement&&(this.popoverElement.style.display="none"),this.highlightOverlay&&(this.highlightOverlay.remove(),this.highlightOverlay=void 0),this.originalTargetStyles.clear(),this.options.onTourEnd(this),this.options.onStepChange(null,n,this)}updateOptions(e){this.options={...this.options,...e},this.isActive&&this.currentStepIndex!==-1&&this._showStepOnTarget(this.currentStepIndex)}}let l=g.ref(null);const p=g.reactive({isActive:!1,currentStepIndex:-1,currentStep:null,totalSteps:0});function w(m=[],e={}){if(l.value)l.value.updateOptions(e),(m.length>0||m.length===0&&l.value.steps.length>0)&&(l.value.defineSteps(m),p.totalSteps=l.value.steps.length);else{const t={...e,onTourStart:r=>{var u;p.isActive=!0,p.totalSteps=r.steps.length,(u=e.onTourStart)==null||u.call(e,r)},onTourEnd:r=>{var u;p.isActive=!1,p.currentStepIndex=-1,p.currentStep=null,(u=e.onTourEnd)==null||u.call(e,r)},onStepChange:(r,u,v)=>{var y;p.currentStepIndex=v.currentStepIndex,p.currentStep=r,p.totalSteps=v.steps.length,(y=e.onStepChange)==null||y.call(e,r,u,v)}};l.value=new S(m,t),p.isActive=l.value.isActive,p.currentStepIndex=l.value.currentStepIndex,p.currentStep=l.value.currentStepIndex!==-1?l.value.steps[l.value.currentStepIndex]:null,p.totalSteps=l.value.steps.length}const n=t=>{var r;(r=l.value)==null||r.defineSteps(t)},i=t=>{var r;return(r=l.value)==null?void 0:r.start(t)},s=()=>{var t;return(t=l.value)==null?void 0:t.next()},a=()=>{var t;return(t=l.value)==null?void 0:t.prev()},d=()=>{var t;return(t=l.value)==null?void 0:t.end()},c=t=>{var r;return(r=l.value)==null?void 0:r.jumpTo(t)};return{state:g.readonly(p),defineSteps:n,start:i,next:s,prev:a,jumpTo:c,end:d}}h.TourController=S,h.useTour=w,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=vue-floating-ui-tour.umd.js.map
